@echo off
chcp 65001
cls
echo ================================================================
echo           ESP32-C5 Monitor é—®é¢˜è¯Šæ–­å·¥å…·
echo ================================================================
echo.

echo ðŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥ï¼š
echo ----------------------------------------------------------------
echo  âœ… å›ºä»¶å·²æˆåŠŸçƒ§å½•
echo  â“ Monitor æ— è¾“å‡º - å¼€å§‹è¯Šæ–­...
echo.

echo ðŸ”„ æ­¥éª¤1: å¤ä½ESP32-C5
echo ----------------------------------------------------------------
echo ðŸ“Œ é‡è¦ï¼šESP32-C5å¯èƒ½ä»å¤„äºŽä¸‹è½½æ¨¡å¼
echo.
echo è¯·æŒ‰ç…§ä»¥ä¸‹æ“ä½œï¼š
echo  1ï¸âƒ£  æŒ‰ä¸€ä¸‹å¼€å‘æ¿ä¸Šçš„ RESET æŒ‰é’®
echo  2ï¸âƒ£  è§‚å¯Ÿå¼€å‘æ¿æŒ‡ç¤ºç¯å˜åŒ–
echo  3ï¸âƒ£  ç­‰å¾… 3-5 ç§’è®©ç³»ç»Ÿå®Œå…¨å¯åŠ¨
echo  4ï¸âƒ£  æŒ‰ä»»æ„é”®ç»§ç»­è¯Šæ–­...
echo ----------------------------------------------------------------
pause >nul
echo âœ… å¤ä½æ“ä½œå®Œæˆ
echo.

echo ðŸ” æ­¥éª¤2: æ£€æŸ¥ä¸²å£çŠ¶æ€
echo ----------------------------------------------------------------
powershell -Command "Get-WmiObject -Class Win32_SerialPort | Where-Object {$_.DeviceID -eq 'COM4'} | Select-Object DeviceID, Name, Status" 2>nul
if %errorlevel% neq 0 (
    echo âŒ æ— æ³•æ£€æŸ¥COM4çŠ¶æ€
) else (
    echo âœ… COM4 çŠ¶æ€æ£€æŸ¥å®Œæˆ
)
echo.

echo ðŸ›‘ æ­¥éª¤3: æ¸…ç†ä¸²å£å ç”¨
echo ----------------------------------------------------------------
taskkill /f /im "putty.exe" 2>nul
taskkill /f /im "arduino.exe" 2>nul
taskkill /f /im "monitor.exe" 2>nul
taskkill /f /im "minicom.exe" 2>nul
echo âœ… ä¸²å£æ¸…ç†å®Œæˆ
echo.

echo ðŸ“¡ æ­¥éª¤4: å°è¯•ä¸åŒæ³¢ç‰¹çŽ‡çš„Monitor
echo ================================================================
echo.

echo ðŸš€ æ–¹æ³•1: é»˜è®¤æ³¢ç‰¹çŽ‡ 115200
echo ----------------------------------------------------------------
echo æ­£åœ¨å¯åŠ¨ monitor (115200)ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰è¾“å‡º...
echo å¦‚æžœæœ‰è¾“å‡ºï¼ŒæŒ‰ Ctrl+] é€€å‡ºmonitor
echo å¦‚æžœ10ç§’å†…æ— è¾“å‡ºï¼Œå°†è‡ªåŠ¨ç»§ç»­ä¸‹ä¸€ä¸ªæ–¹æ³•
echo.
timeout /t 2 /nobreak >nul
start /B /wait cmd /c "echo å¼€å§‹ç›‘æŽ§... && timeout /t 10 /nobreak >nul && taskkill /f /im python.exe 2>nul" 
idf.py -p COM4 -b 115200 monitor

echo.
echo â“ æ–¹æ³•1æ˜¯å¦æœ‰è¾“å‡ºï¼Ÿ (y/n)
set /p "response1=è¯·è¾“å…¥ y æˆ– n: "
if /i "%response1%"=="y" (
    echo âœ… æ‰¾åˆ°è¾“å‡ºï¼é—®é¢˜å·²è§£å†³
    goto :success
)

echo ðŸš€ æ–¹æ³•2: é«˜æ³¢ç‰¹çŽ‡ 460800
echo ----------------------------------------------------------------
echo æ­£åœ¨å¯åŠ¨ monitor (460800)...
timeout /t 2 /nobreak >nul
idf.py -p COM4 -b 460800 monitor

echo.
echo â“ æ–¹æ³•2æ˜¯å¦æœ‰è¾“å‡ºï¼Ÿ (y/n)
set /p "response2=è¯·è¾“å…¥ y æˆ– n: "
if /i "%response2%"=="y" (
    echo âœ… æ‰¾åˆ°è¾“å‡ºï¼é—®é¢˜å·²è§£å†³
    goto :success
)

echo ðŸš€ æ–¹æ³•3: Bootloaderæ³¢ç‰¹çŽ‡ 74880
echo ----------------------------------------------------------------
echo æ­£åœ¨å¯åŠ¨ monitor (74880) - ESP32 bootloaderé»˜è®¤æ³¢ç‰¹çŽ‡...
timeout /t 2 /nobreak >nul
idf.py -p COM4 -b 74880 monitor

echo.
echo â“ æ–¹æ³•3æ˜¯å¦æœ‰è¾“å‡ºï¼Ÿ (y/n)
set /p "response3=è¯·è¾“å…¥ y æˆ– n: "
if /i "%response3%"=="y" (
    echo âœ… æ‰¾åˆ°è¾“å‡ºï¼é—®é¢˜å·²è§£å†³
    goto :success
)

echo ðŸš€ æ–¹æ³•4: ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·éªŒè¯
echo ----------------------------------------------------------------
echo å¦‚æžœæ‚¨å®‰è£…äº†PuTTYï¼Œå¯ä»¥å°è¯•ï¼š
echo  - æ‰“å¼€PuTTY
echo  - è¿žæŽ¥ç±»åž‹ï¼šSerial
echo  - ä¸²å£ï¼šCOM4
echo  - æ³¢ç‰¹çŽ‡ï¼š115200
echo  - æ•°æ®ä½ï¼š8ï¼Œåœæ­¢ä½ï¼š1ï¼Œæ ¡éªŒï¼šæ— 
echo.
echo æŒ‰ä»»æ„é”®ç»§ç»­æ£€æŸ¥å…¶ä»–å¯èƒ½åŽŸå› ...
pause >nul

echo ðŸ”§ æ­¥éª¤5: é«˜çº§è¯Šæ–­
echo ================================================================
echo.

echo ðŸ” æ£€æŸ¥é¡¹ç›®é…ç½®
echo ----------------------------------------------------------------
echo 1. æ£€æŸ¥ç›®æ ‡èŠ¯ç‰‡é…ç½®ï¼š
idf.py show-target 2>nul
echo.
echo 2. æ£€æŸ¥æ—¥å¿—çº§åˆ«é…ç½®
echo   å»ºè®®è¿è¡Œï¼šidf.py menuconfig
echo   å¯¼èˆªåˆ°ï¼šComponent config -> Log output -> Default log verbosity
echo   è®¾ç½®ä¸ºï¼šInfo æˆ– Debug
echo.

echo ðŸ’¡ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š
echo ================================================================
echo.
echo ðŸ”§ é—®é¢˜1: åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥
echo    è§£å†³ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶å´©æºƒ
echo.
echo ðŸ”§ é—®é¢˜2: æ—¥å¿—çº§åˆ«è¿‡ä½Ž
echo    è§£å†³ï¼šä¿®æ”¹ menuconfig ä¸­çš„æ—¥å¿—çº§åˆ«è®¾ç½®
echo.
echo ðŸ”§ é—®é¢˜3: ESP32-C5ä»åœ¨ä¸‹è½½æ¨¡å¼
echo    è§£å†³ï¼šç¡®ä¿æŒ‰è¿‡ RESET æŒ‰é’®ï¼Œå¤šè¯•å‡ æ¬¡
echo.
echo ðŸ”§ é—®é¢˜4: ç¡¬ä»¶é—®é¢˜
echo    è§£å†³ï¼šæ£€æŸ¥USBçº¿ç¼†ã€é©±åŠ¨ç¨‹åºã€å¼€å‘æ¿ç”µæº
echo.
echo ðŸ”§ é—®é¢˜5: ä»£ç é—®é¢˜
echo    è§£å†³ï¼šæ·»åŠ æ›´å¤šè°ƒè¯•è¾“å‡ºï¼Œæ£€æŸ¥mainå‡½æ•°æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
echo.

echo ðŸ“ å»ºè®®çš„ä¸‹ä¸€æ­¥ï¼š
echo ================================================================
echo  1ï¸âƒ£  é‡æ–°ç¼–è¯‘å¹¶çƒ§å½•å›ºä»¶ï¼šidf.py build flash
echo  2ï¸âƒ£  æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰printfè¾“å‡º
echo  3ï¸âƒ£  ä½¿ç”¨å…¶ä»–ä¸²å£å·¥å…·éªŒè¯ï¼ˆPuTTYç­‰ï¼‰
echo  4ï¸âƒ£  æ£€æŸ¥å¼€å‘æ¿ç¡¬ä»¶æ–‡æ¡£å’ŒåŽŸç†å›¾
echo  5ï¸âƒ£  å°è¯•ç®€å•çš„"Hello World"ç¨‹åº
echo.
goto :end

:success
echo.
echo ðŸŽ‰ Monitoré—®é¢˜å·²è§£å†³ï¼
echo ================================================================
echo  âœ… ESP32-C5 ä¸²å£è¾“å‡ºæ­£å¸¸
echo  ðŸ“ è®°ä½ä½¿ç”¨æ­£ç¡®çš„æ³¢ç‰¹çŽ‡
echo  ðŸ” å¦‚æžœè¾“å‡ºä¸å®Œæ•´ï¼Œæ£€æŸ¥æ—¥å¿—çº§åˆ«è®¾ç½®
echo.

:end
echo ðŸ“– è¯¦ç»†æ•…éšœæŽ’é™¤æŒ‡å—ï¼šESP32C5_Monitoré—®é¢˜è§£å†³æŒ‡å—.md
echo æŒ‰ä»»æ„é”®é€€å‡º...
pause >nul 